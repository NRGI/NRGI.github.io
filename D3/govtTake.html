<!DOCTYPE html>
<html>
	
	<head>
		<meta charset="utf-8">
		<title>Gini Graph</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		
		<style>
			html {
				font-family: "Lucida Sans Unicode"
			}
		
			#plot {
				height:600px;
				width:1500px
			}
			
			#plot1 {
				float: left;
				height: 600px;
				width: 500px;
				background-color: white
			}
			#plot2 {
				float: left;
				height: 600px;
				width: 500px;
				background-color: white
			}
			#plot3 {
				float: right;
				height: 600px;
				width: 500px;
				background-color: white
			}
			#button {
				float: left;
			}
		</style>
	</head>

	<body>
		<div id='plot'>
			<div id='plot1'></div>
			<div id='plot2'></div>
			<div id='plot3'></div>
		</div>
		
		<div>
			<button id='button' onclick="switchGraph()">Switch Y Axis</button>
			<h4></h4>
		</div>
		<script>
			var margin = {top:40, bottom:40, left:70, right:40}
			var width = 500 - margin.left - margin.right
			var height = 600 - margin.top - margin.bottom
			
			var svg1 = d3.select('#plot1').append('svg')
							.attr('width', width + margin.left + margin.right)
							.attr('height', height + margin.top + margin.bottom)
						.append('g')
							.attr('transform','translate('+margin.left+','+margin.top+')')
			
			var svg2 = d3.select('#plot2').append('svg')
							.attr('width', width + margin.left + margin.right)
							.attr('height', height + margin.top + margin.bottom)
						.append('g')
							.attr('transform','translate('+margin.left+','+margin.top+')')
			
			var svg3 = d3.select('#plot3').append('svg')
							.attr('width', width + margin.left + margin.right)
							.attr('height', height + margin.top + margin.bottom)
						.append('g')
							.attr('transform','translate('+margin.left+','+margin.top+')')
			
			var tooltip = d3.select("body")
										.append("div")
										.attr('class','tooltip')
										.style('color','black')
										.style("position", "absolute")
										.style("z-index", "10")
			
			
			//svg.append('circle').attr('cx',0).attr('cy',0).attr('r',5)
						
			var dat
			
			var xScale							
			var yScaleGov
			var yScaleTotal
			var colorScale
			
			var xAxis
			var yAxisGov
			var yAxisTotal
			
			var active1 = 'yes'
			var active2 = 'yes'
			var samp
			
			d3.csv('govtTake3.csv', function(data) {
				dat = data
				xScale = d3.scaleLinear()
							.domain([d3.min(dat, function(d){return +d.Year}), d3.max(dat, function(d){return +d.Year})])
							.range([0 , width])
							
				//Use w/ `value`
				yScaleGov =d3.scaleLinear()
								.domain([0, d3.max(dat, function(d){return +d.value})])
								.range([height, 0])
				
				//Use w/ `totalValue`
				yScaleTotal =d3.scaleLinear()
								.domain([0, d3.max(dat, function(d){return +d.totalValue})])
								.range([height, 0])
				
				colorScale = d3.scaleQuantize()
								.domain([d3.min(dat, function(d){return +d.Percent}), d3.max(dat, function(d){return +d.Percent})])
								.range(["#5E4FA2", "#3288BD", "#66C2A5", "#ABDDA4", "#E6F598", "#FFFFBF", "#FEE08B", "#FDAE61", "#F46D43", "#D53E4F", "#9E0142"])

				oScale = d3.scaleLinear()
									.domain([0,1])//.domain([d3.min(dat, function(d){return +d.Percent}), d3.max(dat, function(d){return +d.Percent})])
									.range([.3, 1])

				
				xAxis = d3.axisBottom(xScale).tickFormat(d3.format("d"))
				yAxisGov = d3.axisLeft(yScaleGov)
				yAxisTotal = d3.axisLeft(yScaleTotal)
				
				
				svg1.selectAll('rect')
					.data(dat.filter(function(d){return d.Country==='Peru'}))
					.enter()
					.append('rect')
						.attr('class', 'Peru')
						.attr('class', function(d,i){return "bar"+i})
						.attr('year', function(d){return Math.round(d.Year)})
						.attr('x', function(d){return xScale(+d.Year)-15})
						.attr('y', function(d){return yScaleGov(+d.value)})
						.attr('height', function(d){return height-yScaleGov(+d.value)})
						.attr('width', 30)
						.attr('fill','#FF6E49')
						.attr('stroke','black')
						//.attr('opacity', function(d){return oScale(+d.Percent)})

				svg2.selectAll('rect')
					.data(dat.filter(function(d){return d.Country==='Bolivia'}))
					.enter()
					.append('rect')
						.attr('year', function(d){return Math.round(d.Year)})
						.attr('class', 'Bolivia')
						.attr('class', function(d,i){return "bar"+i})
						.attr('x', function(d){return xScale(+d.Year)-15})
						.attr('y', function(d){return yScaleGov(+d.value)})
						.attr('height', function(d){return height-yScaleGov(+d.value)})
						.attr('width', 30)
						.attr('fill','#FF6E49')
						.attr('stroke','black')
						//.attr('opacity', function(d){return oScale(+d.Percent)})
				
				svg3.selectAll('rect')
					.data(dat.filter(function(d){return d.Country==='Ecuador'}))
					.enter()
					.append('rect')
						.attr('year', function(d){return Math.round(d.Year)})
						.attr('class', 'Ecuador')
						.attr('class', function(d,i){return "bar"+i})
						.attr('x', function(d){return xScale(+d.Year)-15})
						.attr('y', function(d){return yScaleGov(+d.value)})
						.attr('height', function(d){return height-yScaleGov(+d.value)})
						.attr('width', 30)
						.attr('fill','#FF6E49')
						.attr('stroke','black')
					
				d3.selectAll('rect')
					.on('mouseover', function(d,i) {
					
							if(active2=='yes'){display = Math.round(d.value)}else{ display=Math.round(d.totalValue)}
							year = d3.select(this).attr('year')
							
							d3.selectAll('[year="'+year+'"]')
								.transition()
								.duration(400)
								.attr('fill','#517186')
							//d3.select('.tooltip')
							//	tooltip.transition()
							//		.style('visibility','visible')
							//	tooltip.html('<b>$'+ display.toLocaleString() +'</b>')
							//				.style('font-size','14px')
							//				.style('font-family','sans-serif')
							//				.style("left", (d3.event.pageX-10) + "px")											
							//				.style("top", (d3.event.pageY - 35) + "px")
											
						})
						.on('mouseout', function(d,i) {
							d3.selectAll('[year="'+year+'"]')
								.transition()
								.duration(400)
								.attr('fill','#FF6E49')
								//.attr('stroke', function(d){return fillScale(d.key)})
							//d3.select('.tooltip')
							//	tooltip.transition()
							//		.style('visibility','hidden')
						})
				
				
				
				
				d3.selectAll('svg').append('g')
					.attr('class', 'xaxis')
					.attr('transform', 'translate('+ margin.left +','+ (height+margin.bottom) +')')
					.call(xAxis)
				d3.selectAll('svg').append('g')
					.attr('class', 'yaxis')
					.attr('transform', 'translate('+ (margin.left-20) +','+ margin.top +')')
					.call(yAxisGov)
				
				svg1.append('text')
					.attr('x', ((width/2)-margin.left))
					.attr('y', -10)
					.style('font-family', "Lucida Sans Unicode")
					.text("Peru")
				svg2.append('text')
					.attr('x', ((width/2)-margin.left))
					.attr('y', -0)
					.style('font-family', "Lucida Sans Unicode")
					.text("Bolivia")
				svg3.append('text')
					.attr('x', ((width/2)-margin.left))
					.attr('y', -0)
					.style('font-family', "Lucida Sans Unicode")
					.text("Ecuador")
				
				d3.select('h4').append('text').text('Showing: Government take (million USD)')
				
				
			})
			
			function switchGraph() {
				if(active2=='yes') {
								d3.selectAll('rect')
									.transition()
									.duration(1000)
										.attr('y', function(d){return yScaleTotal(+d.totalValue)})
										.attr('height', function(d){return height-yScaleTotal(+d.totalValue)});
								
								d3.selectAll('.yaxis')
									.transition()
									.duration(1000)
									.call(yAxisTotal)
								d3.select('h4')
									.transition()
									.duration(1000)
									.text('Showing: Total production value (million USD)')
								
								active2 = 'no'
							} else {
							//if(active=='no') {
								d3.selectAll('rect')
									.transition()
									.duration(1000)
										.attr('y', function(d){return yScaleGov(+d.value)})
										.attr('height', function(d){return height-yScaleGov(+d.value)})
								
								d3.selectAll('.yaxis')
									.transition()
									.duration(1000)
									.call(yAxisGov)
								
								d3.select('h4')
									.transition()
									.duration(1000)
									.text('Showing: Government take (million USD)')
								
								active2 = 'yes'
							}			
			}
		
		
		</script>
	</body>


</html>